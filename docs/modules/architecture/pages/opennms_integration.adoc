= OpenNMS Integration
:imagesdir: ../assets/images

The following diagram depicts the various components involved in the life-cycle of an alarm and correlation with OpenNMS 24.0.0 and OCE:

image::opennms_alarm_lifecycle.png[Alarm lifecyle,600]

Events are generated by existing services that either process unsolicited messages or actively poll the monitored elements.

These events are then sent to _eventd_ where they are processed and enriched with the matching configuration.

_alarmd_ listens for events that contain alarm meta-data and creates or updates alarms that correspond to these.
In addition to the existing alarm processing that was present in OpenNMS before 24.0.0 _alarmd_ now expose a series of link:https://github.com/OpenNMS/opennms-integration-api/blob/1f08398169d10538da7379e13eb8f4cd23933450/api/src/main/java/org/opennms/integration/api/v1/alarms/AlarmPersisterExtension.java[hooks] that can be used to alter/enrich the alarms when they are created.

OCE leverages these hooks to perform additional processing and *tag* the alarms with a model object type and model object instance.
See the <<inventory_mapping>> section bellow for more details.

OpenNMS also provides facilities to be notified when alarms are in some way modified.
The <<direct_datasource>> leverages API hooks directly into the run-time, whereas the <<kafka_datasource>> leverages the Kafka integration for interfacing externally.

[[inventory_mapping]]
== Inventory mapping

The model and inventory mapping logic in the link:https://github.com/OpenNMS/oce/blob/master/datasource/api/src/main/java/org/opennms/oce/datasource/api/InventoryDatasource.java[InventoryDatasource] drive how the graph is layed out.

== Datasources

[[direct_datasource]]
=== Direct Datasource

We integrate with OpenNMS using the link:https://github.com/OpenNMS/opennms-integration-api[OIA] and package OCE as a plugin instead of being integrated directly into the core 

[[kafka_datasource]]
=== Kafka Datasource

We integration with OpenNMS using the Kafka Producer feature and consume the protobuf payloads sent to the topics.
